<!doctype html>
<html lang="zh">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>白色背景烟花效果</title>
        <style>
            body {
                margin: 0;
                /* 【修改 1】: 背景改为浅灰色（白色系） */
                background-color: #f4f4f4;
                overflow: hidden;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                font-family: Arial, sans-serif;
                /* 【修改 2】: 默认文字颜色改为深色 */
                color: #333;
                text-align: center;
            }
            canvas {
                position: absolute;
                top: 0;
                left: 0;
                display: block;
                /* 【修改 3】: Canvas 背景也改为浅灰色 */
                background-color: #f4f4f4;
                z-index: 0;
            }
            #message {
                position: relative;
                z-index: 1;
                font-size: 3em;
                /* 【修改 4】: 消息文字颜色改为深色，并添加一点阴影 */
                color: #222;
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            }
        </style>
    </head>
    <body>
        <canvas id="fireworksCanvas"></canvas>
        <div id="message">恭喜通关！</div>

        <script>
            const canvas = document.getElementById("fireworksCanvas");
            const ctx = canvas.getContext("2d");
            const messageDiv = document.getElementById("message");
            let particles = [];
            const gravity = 0.05; // 重力

            // 背景色 (用于拖尾)
            const bgColor = "rgba(244, 244, 244, 0.2)"; // 对应 #f4f4f4，透明度 0.2

            // 设置 canvas 尺寸
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();

            // 随机数辅助函数
            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            /**
             * 粒子类 (用于火箭和爆炸火花)
             */
            class Particle {
                constructor(x, y, vx, vy, color, isLauncher) {
                    this.x = x;
                    this.y = y;
                    this.vx = vx;
                    this.vy = vy;
                    this.color = color;
                    this.isLauncher = isLauncher;
                    this.alpha = 1;
                    this.life = random(30, 60);
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;

                    if (!this.isLauncher) {
                        this.vy += gravity;
                        this.vx *= 0.98;
                        this.vy *= 0.98;
                        this.alpha -= 0.02;
                    } else {
                        this.vx *= 0.99;
                        this.vy *= 0.99;
                        this.life--;
                        if (this.life <= 0) {
                            this.alpha = 0;
                            createExplosion(this.x, this.y, this.color);
                        }
                        if (this.life < 15) {
                            this.vy += gravity * 0.5;
                        }
                    }
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;

                    // --- 【修改 5】: 为粒子添加阴影 ---
                    // 这是在白色背景上“看清”烟花的关键
                    ctx.shadowBlur = 5; // 阴影模糊半径
                    ctx.shadowColor = "rgba(0, 0, 0, 0.3)"; // 阴影颜色
                    // --- --------------------------

                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }

            /**
             * 创建一次爆炸
             */
            function createExplosion(x, y, color) {
                const particleCount = 100;
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = random(1, 5);
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;

                    particles.push(new Particle(x, y, vx, vy, color, false));
                }
            }

            /**
             * 自动发射一个烟花火箭
             */
            function autoLaunchFirework() {
                let startX, startY;
                let targetX, targetY;
                const edge = Math.floor(random(0, 4));

                switch (edge) {
                    case 0:
                        startX = random(0, canvas.width);
                        startY = canvas.height;
                        targetX = random(
                            canvas.width * 0.1,
                            canvas.width * 0.9,
                        );
                        targetY = random(
                            canvas.height * 0.1,
                            canvas.height * 0.9,
                        );
                        break;
                    case 1:
                        startX = random(0, canvas.width);
                        startY = 0;
                        targetX = random(
                            canvas.width * 0.1,
                            canvas.width * 0.9,
                        );
                        targetY = random(
                            canvas.height * 0.1,
                            canvas.height * 0.9,
                        );
                        break;
                    case 2:
                        startX = 0;
                        startY = random(0, canvas.height);
                        targetX = random(
                            canvas.width * 0.1,
                            canvas.width * 0.9,
                        );
                        targetY = random(
                            canvas.height * 0.1,
                            canvas.height * 0.9,
                        );
                        break;
                    case 3:
                        startX = canvas.width;
                        startY = random(0, canvas.height);
                        targetX = random(
                            canvas.width * 0.1,
                            canvas.width * 0.9,
                        );
                        targetY = random(
                            canvas.height * 0.1,
                            canvas.height * 0.9,
                        );
                        break;
                }

                if (
                    Math.abs(targetX - startX) < 10 &&
                    Math.abs(targetY - startY) < 10
                ) {
                    targetX = random(canvas.width * 0.1, canvas.width * 0.9);
                    targetY = random(canvas.height * 0.1, canvas.height * 0.9);
                }

                const angle = Math.atan2(targetY - startY, targetX - startX);
                const speed = random(15, 25);
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;

                const hue = random(0, 360);
                // 【修改 6】: 调整 HSL 颜色。在白色背景上，饱和度高、亮度适中（50-60%）的颜色效果最好
                const color = `hsl(${hue}, 100%, 60%)`;

                particles.push(
                    new Particle(startX, startY, vx, vy, color, true),
                );
            }

            // --- 满屏烟花控制 ---
            const fireworksDuration = 25000;
            const launchInterval = 150;

            let fireworksTimer;
            let launchIntervalId;

            function startFireworks() {
                launchIntervalId = setInterval(
                    autoLaunchFirework,
                    launchInterval,
                );

                fireworksTimer = setTimeout(() => {
                    clearInterval(launchIntervalId);
                    console.log("烟花表演结束！");
                }, fireworksDuration);
            }

            function animate() {
                requestAnimationFrame(animate);

                // --- 【修改 7】: 拖尾效果改为“淡入白色” ---
                // 用一个半透明的白色矩形覆盖上一帧
                ctx.fillStyle = bgColor; // 'rgba(244, 244, 244, 0.2)'
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                // --- ---------------------------------

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.update();
                    p.draw();

                    if (
                        p.alpha <= 0 ||
                        p.x < -100 ||
                        p.x > canvas.width + 100 ||
                        p.y < -100 ||
                        p.y > canvas.height + 100
                    ) {
                        particles.splice(i, 1);
                    }
                }
            }

            window.onload = () => {
                animate();
                startFireworks();
            };
        </script>
    </body>
</html>
